% ==============================================================================
% This file is part of the "LaTeX template for writing the Final Degree Work
% report". It has been developed to aid the students of the Bachelor's Degree in
% Video Game Design and Development at the Jaume I University.
%
% (c) 2019 Sergio Barrachina Mir and José Vte. Martí Avilés
%
% The template can be used and distributed under the next license:
%  Creative Commons Attribution-NonCommercial-ShareAlike (CC BY-NC-SA)
%  http://creativecommons.org/licenses/by-nc-sa/3.0/
%  http://creativecommons.org/licenses/by-nc-sa/3.0/legalcode
%
% Atom editor configuration follows:
% !TEX root = ./report.tex
% !TeX spellcheck = en-US
% ==============================================================================

\chapter{Dynamic standard deviation}

\label{app:stddyn}


Starting from the variance\footnote{We use variance instead of standard deviation to simplify the equations: the standard deviation can be obtained taking the square root of the variance} formula:
$ {\displaystyle \frac1n\sum_{i=1}^{n}(x_i-a_n)^2=v_n} $\\\\

\noindent
\scalebox{0.85}{
$ {\displaystyle \frac1n\sum_{i=1}^{n}(x_i-a_n)^2-v_n=\frac1{n+1}\sum_{i=1}^{n+1}(x_i-a_{n+1})^2-v_{n+1}} $\\\\
}

We want to solve the equation for $v_{n+1}$:

\noindent
\scalebox{0.85}{
$ {\displaystyle (n+1)\sum_{i=1}^{n}(x_i-a_n)^2-n(n+1)v_n=n\sum_{i=1}^{n+1}(x_i-a_{n+1})^2-n(n+1)v_{n+1}} $\\\\
}

\noindent
\scalebox{0.85}{
$ {\displaystyle (n+1)\sum_{i=1}^{n}(x_i^2-2x_i\cdot a_n+a_n^2)-n(n+1)v_n=n\sum_{i=1}^{n+1}(x_i^2-2x_i\cdot a_{n+1}+a_{n+1}^2)-n(n+1)v_{n+1}} $\\\\
}

\noindent
\scalebox{0.85}{
$ {\displaystyle (n+1)(\sum_{i=1}^{n}x_i^2 - 2a_n\sum_{i=1}^{n}x_i + na_n^2) - n(n+1)v_n = n(\sum_{i=1}^{n+1}x_i^2 - 2a_{n+1}\sum_{i=1}^{n+1}x_i + (n+1)a_{n+1}^2) - n(n+1)v_{n+1}} $\\\\
}

\noindent
\scalebox{0.85}{
$ {\displaystyle (n+1)(\sum_{i=1}^{n}x_i^2 - 2a_n\sum_{i=1}^{n}x_i + na_n^2) = n(n+1)(v_n-v_{n+1}) + n(\sum_{i=1}^{n+1}x_i^2 - 2a_{n+1}\sum_{i=1}^{n+1}x_i + (n+1)a_{n+1}^2)} $\\\\
}

\noindent
\scalebox{0.85}{
$ {\displaystyle (n+1)\sum_{i=1}^{n}x_i^2 - 2(n+1)a_n\sum_{i=1}^{n}x_i + n(n+1)a_n^2 = n(n+1)(v_n-v_{n+1}) + n\sum_{i=1}^{n+1}x_i^2 - 2na_{n+1}\sum_{i=1}^{n+1}x_i + n(n+1)a_{n+1}^2} $\\\\
}

\noindent
\scalebox{0.85}{
$ {\displaystyle (n+1)\sum_{i=1}^{n}x_i^2 - 2(n+1)a_n\sum_{i=1}^{n}x_i + n(n+1)a_n^2 = n(n+1)(v_n-v_{n+1}) + n\sum_{i=1}^{n}x_i^2 + nx_{n+1}^2 - 2na_{n+1}\sum_{i=1}^{n+1}x_i + n(n+1)a_{n+1}^2} $\\\\
}

\noindent
\scalebox{0.85}{
$ {\displaystyle (n+1)\sum_{i=1}^{n}x_i^2 - 2(n+1)a_n\sum_{i=1}^{n}x_i = n(n+1)(v_n-v_{n+1}+a_{n+1}^2-a_n^2) + n\sum_{i=1}^{n}x_i^2 + nx_{n+1}^2 - 2na_{n+1}\sum_{i=1}^{n+1}x_i } $\\\\
}

\noindent
\scalebox{0.85}{
$ {\displaystyle n\sum_{i=1}^{n}x_i^2 + \sum_{i=1}^{n}x_i^2 - 2(n+1)a_n\sum_{i=1}^{n}x_i = n(n+1)(v_n-v_{n+1}+a_{n+1}^2-a_n^2) + n\sum_{i=1}^{n}x_i^2 + nx_{n+1}^2 - 2na_{n+1}\sum_{i=1}^{n+1}x_i } $\\\\
}

\noindent
\scalebox{0.85}{
$ {\displaystyle \sum_{i=1}^{n}x_i^2 - 2(n+1)a_n\sum_{i=1}^{n}x_i = n(n+1)(v_n-v_{n+1}+a_{n+1}^2-a_n^2) + nx_{n+1}^2 - 2na_{n+1}\sum_{i=1}^{n+1}x_i } $\\\\
}

\noindent
\scalebox{0.85}{
$ {\displaystyle \sum_{i=1}^{n}x_i^2 - 2(n+1)a_n\cdot na_n = n(n+1)(v_n-v_{n+1}+a_{n+1}^2-a_n^2) + nx_{n+1}^2 - 2na_{n+1}\cdot (n+1)a_{n+1} } $\\\\
}

\noindent
\scalebox{0.85}{
$ {\displaystyle \sum_{i=1}^{n}x_i^2 - 2n(n+1)a_n^2 = n(n+1)(v_n-v_{n+1}+a_{n+1}^2-a_n^2) + nx_{n+1}^2 - 2n(n+1)a_{n+1}^2 } $\\\\
}

\noindent
$ {\displaystyle \sum_{i=1}^{n}x_i^2 = nx_{n+1}^2 + n(n+1)(v_n-v_{n+1}) - n(n+1)(a_n^2-a_{n+1}^2) + 2n(n+1)(a_n^2-a_{n+1}^2) } $\\\\

\noindent
$ {\displaystyle \sum_{i=1}^{n}x_i^2 = nx_{n+1}^2 + n(n+1)(v_n-v_{n+1}) + n(n+1)(a_n^2-a_{n+1}^2) } $\\\\

\noindent
$ {\displaystyle \frac{\sum_{i=1}^{n}x_i^2}{n} = x_{n+1}^2 + (n+1)(v_n-v_{n+1} + a_n^2-a_{n+1}^2) } $\\\\

\noindent
$ {\displaystyle \frac{\sum_{i=1}^{n}x_i^2}{n} - x_{n+1}^2 = (n+1)(v_n-v_{n+1} + a_n^2-a_{n+1}^2) } $\\\\

\noindent
$ {\displaystyle \frac{\frac{\sum_{i=1}^{n}x_i^2}{n} - x_{n+1}^2}{n+1} = v_n-v_{n+1} + a_n^2-a_{n+1}^2 } $\\\\

\noindent
\scalebox{1.2}{
$ {\displaystyle v_{n+1} = v_n + a_n^2-a_{n+1}^2 - \frac{\frac{\sum_{i=1}^{n}x_i^2}{n} - x_{n+1}^2}{n+1} } $\\\\
}

\vspace{5mm}

Finally, the standard deviation can be obtained with $\sigma_n=\sqrt{v_n}$

It has been proven that the standard deviation of N+1 elements can be obtained knowing the standard deviation (or variance) of the N previous elements, the new element, the averages of the N and N+1 elements and the average of the N previous elements squared, with cost O(1).
